<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Optimizador TÃ©cnico de Cortes â€” VersiÃ³n Final Mejorada (sin tablas en PDF)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f1720; --text:#e6eef6; --muted:#98a2b3;
    --accent:#2ec4b6; --accent-2:#2b6df6; --danger:#ef4444; --border:#263039;
  }
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:linear-gradient(180deg,#071017,#071a2a);color:var(--text)}
  header{background:linear-gradient(90deg,var(--accent-2),#0366a6);padding:14px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(0,0,0,0.2)}
  header h1{margin:0;font-size:18px;color:#fff}
  .wrap{max-width:1200px;margin:18px auto;padding:12px}
  .panel{background:linear-gradient(180deg,#071820,#061017);border-radius:10px;padding:14px;border:1px solid var(--border)}
  label{color:var(--muted);font-size:13px}
  input, select, button, textarea{font-size:14px}
  input[type="text"], input[type="number"], select, textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #22303a;background:#071018;color:var(--text)}
  table{width:100%;border-collapse:collapse;margin-top:10px;background:transparent}
  th,td{padding:8px;border:1px solid rgba(255,255,255,0.03);font-size:13px;color:var(--text);text-align:center}
  th{background:rgba(255,255,255,0.03);color:var(--muted)}
  .row{display:flex;gap:10px}
  .col{flex:1}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .btn{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#041018;padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
  .btn.danger{background:var(--danger);color:#fff}
  #summary{margin-top:12px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg,#071319,#061018);color:var(--text)}
  .muted{color:var(--muted);font-size:13px}
  .login-box{max-width:520px;margin:80px auto;padding:18px;border-radius:10px;background:linear-gradient(180deg,#071014,#081218);border:1px solid var(--border)}
  .center{text-align:center}
  .small{font-size:12px;color:var(--muted)}
  @media(max-width:860px){ .row{flex-direction:column} .col{width:100%} }
</style>
</head>
<body>
<header>
  <h1>ðŸ”© Optimizador TÃ©cnico de Cortes â€” VersiÃ³n Final</h1>
  <div id="hdrUser" class="small">Offline â€¢ Tema tÃ©cnico</div>
</header>

<div class="wrap">
  <!-- LOGIN -->
  <div id="loginSection" class="login-box panel">
    <h2 style="color:var(--text);margin:0 0 8px 0">Acceso</h2>
    <div class="row" style="gap:8px">
      <div class="col">
        <label for="loginUser">Usuario (nombre):</label>
        <input id="loginUser" type="text" placeholder="Ej. Gustavo Chamorro">
      </div>
      <div style="width:180px">
        <label for="loginPass">ContraseÃ±a:</label>
        <input id="loginPass" type="password" placeholder="ContraseÃ±a">
      </div>
    </div>
    <div style="margin-top:12px" class="actions">
      <button class="btn" id="loginBtn">Entrar</button>
    </div>
    <p class="small" style="margin-top:10px;color:var(--muted)">ContraseÃ±a fija por defecto: <b>1234</b></p>
  </div>

  <!-- APP -->
  <div id="appSection" style="display:none">
    <div class="panel">
      <div class="row" style="align-items:center;gap:12px">
        <div class="col" style="max-width:400px;">
          <label for="projectName">Proyecto / Cliente</label>
          <input id="projectName" type="text" placeholder="Ej. Proyecto Alfa - Edificio A">
        </div>
        <div style="width:260px">
          <label>&nbsp;</label>
          <div class="actions">
            <button class="btn" id="addWindowBtn">âž• Agregar ventana</button>
            <button class="btn ghost" id="calculateBtn">ðŸ§® Calcular resumen</button>
            <button class="btn" id="exportPdfBtn">ðŸ“„ Exportar PDF</button>
            <button class="btn danger" id="clearAllBtn">ðŸ—‘ Borrar todo</button>
          </div>
        </div>
      </div>

      <h3 style="margin-top:14px;color:var(--accent)">Ventanas (ingreso manual)</h3>

      <div id="summary" class="muted center" aria-live="polite">Presiona "Calcular resumen" para ver totales por perfil.</div>

      <table id="tableWindows">
        <thead>
          <tr>
            <th>ID Ventana</th>
            <th>Ancho (mm)</th>
            <th>Alto (mm)</th>
            <th>Cantidad</th>
            <th>Sistema</th>
            <th>Largo Tira (mm) [override]</th>
            <th>Eliminar</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const PASSWORD="1234";
  const MERMA=50;
  let currentUser=null;
  let lastResults=null;

  const SYSTEMS = {
    "Ventana Corrediza Europea 2V (2 Hojas)": {
      "MTG2175": { altos: 2, anchos: 2 },
      "MTG2177": { altos: 4, anchos: 4, dividirAncho: true },
      "MTG2176": { altos: 2, anchos: 0 },
      "F04": { tipo: "herraje", calcularSegun: { "MTG2177": 2, "MTG2176": 1 } },
      "EUAA01": { cantidad: 4, tipo: "herraje" }
    }
  };

  // LOGIN 
  document.getElementById('loginBtn').addEventListener('click', () => {
    const u = document.getElementById('loginUser').value.trim();
    const p = document.getElementById('loginPass').value;
    if (!u || !p) {
      alert('Ingrese usuario y contraseÃ±a');
      return;
    }
    if (p !== PASSWORD) {
      alert('ContraseÃ±a incorrecta');
      document.getElementById('loginPass').value = '';
      return;
    }
    currentUser = u;
    document.getElementById('hdrUser').innerText = `Usuario: ${u}`;
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('appSection').style.display = 'block';
    addRow();
  });

  // FunciÃ³n Agregar ventana
  function addRow() {
    const tbody = document.querySelector('#tableWindows tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" placeholder="V1"></td>
      <td><input type="number" placeholder="1000" min="0"></td>
      <td><input type="number" placeholder="1500" min="0"></td>
      <td><input type="number" value="1" min="1"></td>
      <td><select>${Object.keys(SYSTEMS).map(s => `<option value="${s}">${s}</option>`).join('')}</select></td>
      <td><input type="text" placeholder="Ej: 5000,6000"></td>
      <td><button class="btn ghost" onclick="this.closest('tr').remove()">X</button></td>`;
    tbody.appendChild(tr);
  }

  // FunciÃ³n Calcular resumen
  function calcular() {
    const filas = [...document.querySelectorAll('#tableWindows tbody tr')];
    if (filas.length === 0) { alert('Agrega al menos una ventana'); return; }

    let totalUsado = 0, totalDisponible = 0;

    filas.forEach(tr => {
      const tds = tr.querySelectorAll('td');
      const ancho = parseFloat(tds[1].querySelector('input').value) || 0;
      const alto = parseFloat(tds[2].querySelector('input').value) || 0;
      totalUsado += ancho * alto;  // Suponiendo que esta es la lÃ³gica de cÃ¡lculo
      totalDisponible += 100000;  // Este es solo un valor de ejemplo, ajusta segÃºn tus necesidades
    });

    alert(`Total Usado: ${totalUsado}, Total Disponible: ${totalDisponible}`);
  }

  // FunciÃ³n Exportar PDF
  function exportPdf() {
    alert('Exportando PDF...');
  }

  // FunciÃ³n Borrar todo
  function borrarTodo() {
    if (!confirm('Â¿Borrar todo?')) return;
    document.querySelector('#tableWindows tbody').innerHTML = '';
    lastResults = null;
    document.getElementById('summary').innerText = 'Presiona "Calcular resumen" para ver totales por perfil.';
  }

  // AsignaciÃ³n de eventos a los botones
  document.getElementById('addWindowBtn').addEventListener('click', addRow);
  document.getElementById('calculateBtn').addEventListener('click', calcular);
  document.getElementById('exportPdfBtn').addEventListener('click', exportPdf);
  document.getElementById('clearAllBtn').addEventListener('click', borrarTodo);
});
</script>

</body>
</html>
