<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Optimizador de Cortes</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { color: #333; }
    label { display: inline-block; width: 220px; margin-top: 10px; }
    input, select { padding: 5px; margin-top: 10px; }
    button { margin-top: 20px; padding: 10px 15px; cursor: pointer; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #333; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>
  <h2>ðŸ”§ CÃ¡lculo de Cortes</h2>

  <label for="alto">Alto (mm):</label>
  <input type="number" id="alto"><br>

  <label for="ancho">Ancho (mm):</label>
  <input type="number" id="ancho"><br>

  <label for="largo">Largo de Tira Disponible (mm):</label>
  <input type="number" id="largo" value="6000"><br>

  <label for="sistema">Sistema:</label>
  <select id="sistema">
    <option value="corrediza">Ventana Corrediza Europea</option>
    <option value="fija">Ventana Fija</option>
  </select><br>

  <button onclick="calcular()">Calcular</button>
  <button onclick="exportarPDF()">Exportar a PDF</button>

  <div id="resultado"></div>

  <script>
    // DefiniciÃ³n de sistemas y perfiles
    const sistemas = {
      "corrediza": {
        "MTG1399": { altos: 2, anchos: 2 },
        "MTG2177": { altos: 4, anchos: 2 },
        "MTG2176": { altos: 2, anchos: 0 },
        "MTG2078": { altos: 2, anchos: 1 },
      },
      "fija": {
        "MTG2180": { altos: 2, anchos: 2 },
        "MTG2184": { altos: 2, anchos: 2 }
      }
    };

    let ultimoResumen = {};

    function calcular() {
      const alto = parseInt(document.getElementById("alto").value);
      const ancho = parseInt(document.getElementById("ancho").value);
      const largoDisponible = parseInt(document.getElementById("largo").value);
      const sistema = document.getElementById("sistema").value;

      if (!alto || !ancho) {
        alert("Por favor ingrese alto y ancho.");
        return;
      }

      let resultados = {};
      let totalTiras = {};

      for (let perfil in sistemas[sistema]) {
        const def = sistemas[sistema][perfil];

        // Cantidad total en mm (con repeticiones por altos y anchos)
        let totalMM = (def.altos * alto) + (def.anchos * ancho);

        // Merma de 150 mm por cada corte
        let cortes = def.altos + def.anchos;
        totalMM += cortes * 150;

        resultados[perfil] = totalMM;

        // NÃºmero de tiras necesarias
        totalTiras[perfil] = Math.ceil(totalMM / largoDisponible);
      }

      ultimoResumen = totalTiras;

      mostrarResultados(totalTiras, resultados);
    }

    function mostrarResultados(totalTiras, resultados) {
      let html = "<h3>Resultados</h3>";
      html += "<table><tr><th>Perfil</th><th>Total (mm)</th><th>Tiras necesarias</th></tr>";

      for (let perfil in totalTiras) {
        html += `<tr>
                  <td>${perfil}</td>
                  <td>${resultados[perfil]}</td>
                  <td>${totalTiras[perfil]}</td>
                 </tr>`;
      }
      html += "</table>";

      // Resumen arriba
      html = "<h3>Resumen:</h3><ul>" + 
        Object.entries(totalTiras).map(([p, t]) => `<li>Total tiras ${p} = ${t}</li>`).join("") + 
        "</ul>" + html;

      document.getElementById("resultado").innerHTML = html;
    }

    function exportarPDF() {
      if (!ultimoResumen || Object.keys(ultimoResumen).length === 0) {
        alert("Primero calcule los resultados.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(14);
      doc.text("Resumen de Cortes", 14, 20);

      let y = 30;
      for (let perfil in ultimoResumen) {
        doc.text(`Total tiras ${perfil} = ${ultimoResumen[perfil]}`, 14, y);
        y += 10;
      }

      doc.setFontSize(12);
      doc.text("Detalle de Perfiles:", 14, y + 10);

      // Exportar tabla detallada
      let tablaY = y + 20;
      doc.autoTable({
        startY: tablaY,
        head: [['Perfil', 'Total (mm)', 'Tiras necesarias']],
        body: Object.entries(ultimoResumen).map(([perfil, tiras]) => [perfil, "-", tiras]),
      });

      doc.save("resultado_cortes.pdf");
    }
  </script>
  <!-- LibrerÃ­a para tablas en PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</body>
</html>
