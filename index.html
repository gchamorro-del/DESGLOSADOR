<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Optimización de Cortes - Ventanas</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f3f3f3;
      margin: 0;
      padding: 0;
    }
    .login, .main {
      display: none;
      padding: 20px;
      text-align: center;
    }
    .active {
      display: block;
    }
    input, select, button {
      padding: 5px;
      margin: 5px;
      font-size: 14px;
    }
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      background: #fff;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    button {
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    h2 {
      color: #333;
    }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div id="login" class="login active">
    <h2>Acceso al Sistema</h2>
    <input type="password" id="password" placeholder="Ingrese la contraseña"><br>
    <button onclick="login()">Ingresar</button>
  </div>

  <!-- PANTALLA PRINCIPAL -->
  <div id="main" class="main">
    <h2>Cálculo de Cortes</h2>
    <button onclick="addRow()">Agregar Ventana</button>
    <button onclick="clearAll()">Borrar Todo</button>

    <table id="windowTable">
      <thead>
        <tr>
          <th>Alto (mm)</th>
          <th>Ancho (mm)</th>
          <th>Cantidad</th>
          <th>Sistema</th>
          <th>Largo Tira (mm)</th>
          <th>Eliminar</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="calculate()">Calcular</button>
    <button onclick="exportPDF()">Exportar a PDF</button>

    <div id="summary"></div>
  </div>

<script>
  // ===== SISTEMAS =====
  const SYSTEMS = {
    "Corrediza Europea": {
      "MTG1399": { altos: 2, anchos: 2 },
      "MTG2177": { altos: 4, anchos: 2 },
      "MTG2176": { altos: 2, anchos: 0 },
      "EUAA05l": { cantidad: 20, tipo: "herraje" },
      "EUAA07": { cantidad: 24, tipo: "herraje" },
      "EUAP01": { cantidad: 2, tipo: "herraje" }
    },
    "Fija": {
      "MTG2180": { altos: 2, anchos: 2 },
      "MTG2184": { altos: 2, anchos: 2 },
      "EUAA01": { cantidad: 4, tipo: "herraje" }
    },
    "Batiente": {},
    "Proyección": {},
    "Otro": {}
  };

  const MERMA = 50; // mm por corte
  const PASSWORD = "1234";

  // ===== LOGIN =====
  function login() {
    const pass = document.getElementById("password").value;
    if (pass === PASSWORD) {
      document.getElementById("login").classList.remove("active");
      document.getElementById("main").classList.add("active");
      addRow();
    } else {
      alert("Contraseña incorrecta");
    }
  }

  // ===== TABLA =====
  function addRow() {
    const tbody = document.querySelector("#windowTable tbody");
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><input type="number" min="1" step="1"></td>
      <td><input type="number" min="1" step="1"></td>
      <td><input type="number" min="1" step="1" value="1"></td>
      <td>
        <select>
          ${Object.keys(SYSTEMS).map(s => `<option>${s}</option>`).join('')}
        </select>
      </td>
      <td><input type="number" min="1000" step="1" value="6000"></td>
      <td><button onclick="this.parentElement.parentElement.remove()">X</button></td>
    `;
    tbody.appendChild(row);
  }

  function clearAll() {
    document.querySelector("#windowTable tbody").innerHTML = "";
    document.getElementById("summary").innerHTML = "";
  }

  // ===== CÁLCULO =====
  function calculate() {
    const rows = document.querySelectorAll("#windowTable tbody tr");
    if (rows.length === 0) return alert("No hay ventanas registradas.");

    const totalTiras = {};
    const resumenVentanas = [];

    rows.forEach(row => {
      const alto = parseFloat(row.children[0].children[0].value);
      const ancho = parseFloat(row.children[1].children[0].value);
      const cantidad = parseInt(row.children[2].children[0].value);
      const sistema = row.children[3].children[0].value;
      const largoTira = parseFloat(row.children[4].children[0].value);

      if (!alto || !ancho || !cantidad) return;

      resumenVentanas.push({ alto, ancho, cantidad, sistema });

      const perfiles = SYSTEMS[sistema];
      for (const [perfil, datos] of Object.entries(perfiles)) {
        if (datos.tipo === "herraje") {
          totalTiras[perfil] = (totalTiras[perfil] || 0) + (datos.cantidad * cantidad);
        } else {
          const totalAltos = datos.altos * alto * cantidad;
          const totalAnchos = datos.anchos * ancho * cantidad;
          const totalLongitud = totalAltos + totalAnchos;
          const tiras = Math.ceil(totalLongitud / (largoTira - MERMA));
          totalTiras[perfil] = (totalTiras[perfil] || 0) + tiras;
        }
      }
    });

    // Mostrar resumen
    let html = "<h3>Resumen de Perfiles</h3>";
    for (const [perfil, total] of Object.entries(totalTiras)) {
      const esHerraje = Object.values(SYSTEMS).some(sys => sys[perfil]?.tipo === "herraje");
      html += `<p>${perfil}: <strong>${total}</strong> ${esHerraje ? "unidades (herraje)" : "tiras"}</p>`;
    }

    document.getElementById("summary").innerHTML = html;
    window.lastResults = { totalTiras, resumenVentanas };
  }

  // ===== PDF =====
  function exportPDF() {
    if (!window.lastResults) return alert("Primero calcule los resultados.");
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y = 20;

    doc.setFontSize(16);
    doc.text("Informe de Cortes de Ventanas", 20, y);
    y += 10;

    doc.setFontSize(12);
    doc.text("Listado de Ventanas:", 20, y);
    y += 10;

    window.lastResults.resumenVentanas.forEach((v, i) => {
      doc.text(`${i + 1}. ${v.sistema} - ${v.alto}x${v.ancho} mm (x${v.cantidad})`, 25, y);
      y += 8;
    });

    y += 10;
    doc.text("Resumen de Perfiles:", 20, y);
    y += 10;

    for (const [perfil, total] of Object.entries(window.lastResults.totalTiras)) {
      const esHerraje = Object.values(SYSTEMS).some(sys => sys[perfil]?.tipo === "herraje");
      doc.text(`${perfil}: ${total} ${esHerraje ? "unidades (herraje)" : "tiras"}`, 25, y);
      y += 8;

      if (!esHerraje) {
        // Dibujo gráfico de la tira
        doc.setDrawColor(0);
        doc.rect(25, y, 160, 6);
        doc.text("Cortes representativos", 28, y + 5);
        y += 12;
      }
    }

    doc.save("Cortes_Ventanas.pdf");
  }
</script>
</body>
</html>


